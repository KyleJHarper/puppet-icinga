<%
  def zero_or_one(attribute, value)
    return if value.nil? or value == :undef
    value !~ /[01]/ or fail("The attribute '#{attribute}' must be 0 o 1, not '#{value}'.")
  end

  def one_of(attribute, value, allowed)
    return if value.nil? or value == :undef
    value =~ /[a-z](,[a-z])*/ or fail("The attribute '#{attribute}' must be a csv with no spaces, not '#{value}'.")
    value.split(',').each do |letter|
      allowed.include?(letter) or fail("The attribute '#{attribute}' does not allow the letter '#{letter}' found in value '#{value}'.")
    end
    if value.split(',').include?('n') and value.split(',').size > 1 ; then
      fail("Specifying 'n' overrides other flags in the attribute '#{attribute}', you provided '#{value}'.  While it works, it's obnoxious.")
    end
  end

  def is_a_float(attribute, value)
    return if value.nil? or value == :undef
    value !~ /^(([0-9]+([.][0-9]+)?)|([.][0-9]+))$/ or fail("The attribute '#{attribute}' must be an integer or float, not '#{value}'.")
  end

  def is_an_integer(attribute, value)
    return if value.nil? or value == :undef
    if value != :undef and value !~ /^[0-9]+$/ ; then
      fail("The attribute '#{attribute}' must be an integer, not '#{value}'.")
    end
  end

  def not_blank(attribute, value)
    if value.nil? then
      fail("The attribute '#{attribute}' cannot be blank, nil, or undef. Grr: '#{value}'")
    end
  end


  # -- Actual checks.  Could be DRY'd up but it'll make the defs even more complex to read.
  #
  #                                                                          \|/ Alphabetical by attribute
  zero_or_one('active_checks_enabled',        scope['icinga::client::service::active_checks_enabled'])
  zero_or_one('check_freshness',              scope['icinga::client::service::check_freshness'])
  is_a_float('check_interval',                scope['icinga::client::service::check_interval'])
  zero_or_one('event_handler_enabled',        scope['icinga::client::service::event_handler_enabled'])
  zero_or_one('failure_prediction_enabled',   scope['icinga::client::service::failure_prediction_enabled'])
  is_a_float('first_notification_delay',      scope['icinga::client::service::first_notification_delay'])
  zero_or_one('flap_detection_enabled',       scope['icinga::client::service::flap_detection_enabled'])
  one_of('flap_detection_options',            scope['icinga::client::service::flap_detection_options'], ['c','o','u','w'])
  is_an_integer('freshness_threshold',        scope['icinga::client::service::freshness_threshold'])
  is_a_float('high_flap_threshold',           scope['icinga::client::service::high_flap_threshold'])
  one_of('initial_state',                     scope['icinga::client::service::initial_state'], ['c','o','u','w'])
  zero_or_one('is_volatile',                  scope['icinga::client::service::is_volatile'])
  is_a_float('low_flap_threshold',            scope['icinga::client::service::low_flap_threshold'])
  is_an_integer('max_check_attempts',         scope['icinga::client::service::max_check_attempts'])
  is_a_float('notification_interval',         scope['icinga::client::service::notification_interval'])
  one_of('notification_options',              scope['icinga::client::service::notification_options'], ['c','f','n','r','s','u','w'])
  zero_or_one('notifications_enabled',        scope['icinga::client::service::notifications_enabled'])
  zero_or_one('obsess_over_service',          scope['icinga::client::service::obsess_over_service'])
  zero_or_one('passive_checks_enabled',       scope['icinga::client::service::passive_checks_enabled'])
  zero_or_one('process_perf_data',            scope['icinga::client::service::process_perf_data'])
  zero_or_one('retain_nonstatus_information', scope['icinga::client::service::retain_nonstatus_information'])
  zero_or_one('retain_status_information',    scope['icinga::client::service::retain_status_information'])
  is_a_float('retry_interval',                scope['icinga::client::service::retry_interval'])
  not_blank('service_description',            @service_description) #scope['icinga::client::service::service_description'])
#  not_blank('servicegroups',                  scope['icinga::client::service::servicegroups'])
  one_of('stalking_options',                  scope['icinga::client::service::stalking_options'], ['c','n','o','u','w'])

-%>
